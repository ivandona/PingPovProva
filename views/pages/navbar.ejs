<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <img src="/images/Logo_Ping_Pov.png" width="70px" height="70px" href="/v2/home">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">

    <ul class="navbar-nav mr-auto">

      <li class="nav-item active">
        <a class="nav-link px-4" href="/tornei"><b>Tornei</b><span class="sr-only">(current)</span> </a>
      </li>
      <li class="nav-item active">
        <a class="nav-link px-4" href="/match"><b>Partite</b><span class="sr-only">(current)</span> </a>
      </li>
      <li class="nav-item active">
        <a class="nav-link px-4" href="/prenotazioni"><b>Prenotazione Tavolo</b><span
            class="sr-only">(current)</span> </a>
      </li>
      <li class="nav-item active">
        <a class="nav-link px-4" href="/v2/leaderboard"><b>Leaderboard</b><span class="sr-only">(current)</span> </a>
      </li>
    </ul>
    <div class="dropwdown">
      <input type="search" id="search-box" onsearch="searchUser(this)" placeholder="Search" aria-label="Search">
      <section class="dropdown-content" id="searchedUsers"></section>
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Ricerca utente</button>
    </div>
    
    <% if(user !='undefined' && user !="" && user != null) { %>
      <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
        <li> <a href="/v2/profilo"><img src="<%=user.photos[0].value%>" alt="profile pic" width="50px" height="50px"
              style="border-radius: 50%;"></a>
        </li>
        <li class="nav-item px-3">
          <a class="nav-text">
              <p style="color:white"><%=user.displayName%><br><%=user.rank%>rank#53<br>
              <a class="btn btn-outline-danger btn-sm" href="/v2/auth/logout" role="button">Logout</a></p>
        <li class="nav-item">
          <img src="/images/rank_imgs/bronze.png" alt="profile_rank" width="20px" height="20px">
        </li>
        <% } else{ %>
          <li class="nav-item active">
            <a class="nav-link" href="/v2/auth"><b>Login</b></a>
          </li>
          <%}%>
      </ul>
  </div>
</nav>

<script>
  function searchUser(e) {
    const ul = document.getElementById('searchedUsers');
    ul.textContent = '';
    console.log("entrato in searchUser");
    console.log(String(e.value));
    fetch('/v2/users/?username=' + e.value)
      .then((resp) => resp.json())
      .then(function (data) {
        return data.map(function (user) {
          let li = document.createElement('li');
          let span = document.createElement('span');
          let a = document.createElement('a');
          a.href = '/v2/profilo/?user=' + user;
          a.textContent = user.username;

          // Append all our elements
          span.appendChild(a);
          //span.appendChild(button);
          li.appendChild(span);
          ul.appendChild(li);
        })
      })
      .catch(error => console.error(error));
    /*const searchResults = document.getElementBeyId('searchResults');
    fetch('../v2/users', {
      method: 'GET',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ payload: e.value })
    }).then(res => res.json()).then(data => {
      let payload = data.payload;
      searchResults.innerHTML = '';
      payload.forEach((item, index) => {
        if(index > 0) searchResults.innerHTML += '<hr>';
        searchResults.innerHTML += '<p>${item.username}</p>';
      });
    });
    return;*/
  }
</script>
